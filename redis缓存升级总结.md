# redis缓存升级总结

升级缓存key的方案



key uid-orderID

new_key uid-orderID-1





当存储使用——双写

平滑迁移——新缓存读的灰度开关

1. 升级发布期间，使用旧缓存，同时写入新旧缓存；

1. 发布完成后，放量读新缓存的开关

1. 全量读新缓存中，观察是否有异常，有的话要及时回滚

1. 后续上线代码清除开关和替换存量的旧缓存key



当缓存使用

注意新旧缓存分开





需要注意的点

1. **TTL**

- 新key继承旧key剩余TTL

- 避免雪崩：新key的TTL = 原TTL + 随机偏移(±10%)

1. 回滚方案也要考虑正常切换到新缓存的流量

1. 需要检查缓存的全生命周期是否被替换，不要出现遗漏的情况













## **Redis常见缓存问题——需要避免**

1. **缓存穿透**：大量请求查询不存在的数据，绕过缓存直接访问数据库

1. **缓存击穿**：热点key突然失效，大量请求直接打到数据库

1. **缓存雪崩**：大量key同时失效，导致数据库压力骤增

1. **数据一致性**：缓存与数据库数据不一致问题

1. **内存溢出**：数据量超过内存限制导致OOM

1. **性能瓶颈**：大key或热key导致的性能问题